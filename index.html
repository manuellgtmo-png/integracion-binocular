<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√∫per Fusi√≥n Binocular</title>
    <style>
        :root { 
            --bg-clinico: #0a0f1d; 
            --accent-pink: #ff2e63;
            --accent-blue: #08d9d6;
            --rojo-fondo: #80322a;
            --rojo-figura: #69302a;
            --verde-fondo: #69913d;
            --verde-figura: #6c7b5a;
        }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--bg-clinico); color: white; overflow: hidden; height: 100vh; }
        
        /* Pantallas */
        .overlay { position: fixed; inset: 0; background: rgba(10, 15, 29, 0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .card { background: white; color: #2d3436; border-radius: 40px; padding: 40px; width: 90%; max-width: 450px; text-align: center; box-shadow: 0 20px 0 #08d9d6; }
        
        .btn { background: var(--accent-pink); color: white; padding: 20px 40px; border-radius: 20px; font-weight: 900; border: none; cursor: pointer; width: 100%; font-size: 1.3rem; margin-top: 20px; transition: 0.2s; text-transform: uppercase; }
        .btn:active { transform: scale(0.95); }

        /* Juego */
        #game-container { display: flex; height: calc(100vh - 80px); cursor: crosshair; }
        .lado { width: 50%; height: 100%; position: relative; overflow: hidden; }
        #lado-rojo { background: var(--rojo-fondo); border-right: 2px solid rgba(255,255,255,0.1); }
        #lado-verde { background: var(--verde-fondo); }
        
        .figura { position: absolute; font-weight: bold; user-select: none; transition: transform 0.1s; cursor: pointer; }
        
        /* HUD */
        .header { height: 80px; background: #1a1a2e; display: flex; justify-content: space-around; align-items: center; border-bottom: 5px solid var(--accent-pink); }
        .stat { text-align: center; }
        .stat b { display: block; color: var(--accent-blue); font-size: 1.2rem; }
        
        #indicador { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); background: white; color: black; padding: 10px 30px; border-radius: 50px; font-weight: bold; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 3px solid var(--accent-pink); }

        /* Efecto Error */
        #flash { position: fixed; inset: 0; background: rgba(255, 0, 0, 0.5); pointer-events: none; opacity: 0; z-index: 3000; }
        @keyframes flashAnim { 0% { opacity: 1; } 100% { opacity: 0; } }
    </style>
</head>
<body>

    <div id="flash"></div>

    <div id="screen-start" class="overlay">
        <div class="card">
            <h1 style="color:var(--accent-pink); margin:0;">üöÄ ¬°HOLA!</h1>
            <p>Escribe tu nombre para empezar la aventura visual</p>
            <input type="text" id="paciente" style="width:100%; padding:15px; border-radius:15px; border:3px solid #eee; font-size:1.1rem; text-align:center;" placeholder="Tu nombre aqu√≠">
            <button class="btn" onclick="showSkills()">¬°VAMOS!</button>
        </div>
    </div>

    <div id="screen-skills" class="overlay" style="display:none">
        <div class="card" style="background:#0f172a; color:white;">
            <h2 style="color:var(--accent-blue)">‚ú® Misi√≥n de Hoy:</h2>
            <div style="text-align:left; margin: 20px 0;">
                <p>‚ö° <b>S√∫per Reacci√≥n:</b> ¬°Toca r√°pido!</p>
                <p>üéØ <b>Punter√≠a L√°ser:</b> No falles la letra.</p>
                <p>üëÅÔ∏è <b>Fusi√≥n Total:</b> Usa tus dos ojos.</p>
            </div>
            <button class="btn" onclick="startGame()">¬°EMPEZAR!</button>
        </div>
    </div>

    <div class="header">
        <div class="stat"><b>NIVEL</b><span id="txt-nivel">1</span></div>
        <div class="stat"><b>LOGRADOS</b><span id="txt-ok">0</span></div>
        <div class="stat"><b>VIDAS</b><span id="txt-vidas" style="color:#ff2e63">2</span></div>
        <div class="stat"><b>TIEMPO</b><span id="txt-timer">0.0s</span></div>
    </div>

    <div id="indicador">Busca la letra: <span id="target-letra">-</span></div>

    <div id="game-container">
        <div id="lado-rojo" class="lado" onclick="fail(event)"></div>
        <div id="lado-verde" class="lado" onclick="fail(event)"></div>
    </div>

    <script>
        let nivel = 1, ok = 0, vidas = 2, totalAciertos = 0;
        let jugando = false, startTime, letraObjetivo = "";
        let elementos = [];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function beep(freq, dur) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.value = freq; gain.gain.value = 0.1;
            osc.start(); setTimeout(() => osc.stop(), dur);
        }

        function showSkills() {
            if(!document.getElementById('paciente').value) return alert("¬°Dime tu nombre!");
            document.getElementById('screen-start').style.display = 'none';
            document.getElementById('screen-skills').style.display = 'flex';
        }

        function startGame() {
            document.getElementById('screen-skills').style.display = 'none';
            iniciarNivel();
        }

        function iniciarNivel() {
            jugando = true; vidas = 2; ok = 0;
            document.getElementById('txt-vidas').innerText = vidas;
            document.getElementById('txt-nivel').innerText = nivel;
            letraObjetivo = ["E","H","O","X","U","V"][Math.floor(Math.random()*6)];
            document.getElementById('target-letra').innerText = letraObjetivo;
            
            startTime = Date.now();
            generarObjetos();
            requestAnimationFrame(update);
        }

        function generarObjetos() {
            const num = 2 + nivel;
            document.getElementById('lado-rojo').innerHTML = "";
            document.getElementById('lado-verde').innerHTML = "";
            elementos = [];

            for(let i=0; i < num * 2; i++) {
                const esObj = i < num;
                const lado = (i % 2 === 0) ? 'rojo' : 'verde';
                crearElem(esObj, lado);
            }
        }

        function crearElem(esObj, lado) {
            const div = document.createElement('div');
            div.className = "figura";
            div.innerText = esObj ? letraObjetivo : ["A","S","B"][Math.floor(Math.random()*3)];
            
            const size = Math.max(50, 150 - (nivel * 10));
            div.style.fontSize = size + 'px';
            div.style.color = lado === 'rojo' ? 'var(--rojo-figura)' : 'var(--verde-figura)';
            
            const el = {
                dom: div,
                x: Math.random() * (window.innerWidth/2 - 100),
                y: Math.random() * (window.innerHeight - 200),
                vx: (Math.random()-0.5) * (2 + nivel),
                vy: (Math.random()-0.5) * (2 + nivel),
                esObj,
                lado,
                size
            };

            div.onclick = (e) => {
                e.stopPropagation();
                if(esObj) {
                    beep(800, 100);
                    div.remove();
                    elementos = elementos.filter(item => item !== el);
                    totalAciertos++;
                    document.getElementById('txt-ok').innerText = totalAciertos;
                    checkWin();
                } else { fail(); }
            };

            document.getElementById(`lado-${lado}`).appendChild(div);
            elementos.push(el);
        }

        function update() {
            if(!jugando) return;
            const w = window.innerWidth / 2;
            const h = window.innerHeight - 100;

            elementos.forEach(el => {
                el.x += el.vx; el.y += el.vy;
                if(el.x < 0 || el.x > w - el.size) el.vx *= -1;
                if(el.y < 0 || el.y > h - el.size) el.vy *= -1;
                el.dom.style.transform = `translate(${el.x}px, ${el.y}px)`;
            });

            document.getElementById('txt-timer').innerText = ((Date.now()-startTime)/1000).toFixed(1) + "s";
            requestAnimationFrame(update);
        }

        function fail(e) {
            if(!jugando) return;
            vidas--;
            beep(150, 300);
            document.getElementById('flash').style.animation = "flashAnim 0.3s";
            setTimeout(() => document.getElementById('flash').style.animation = "", 300);
            document.getElementById('txt-vidas').innerText = vidas;
            if(vidas <= 0) endGame("¬°√Ånimo! Int√©ntalo de nuevo.");
        }

        function checkWin() {
            const quedan = elementos.filter(e => e.esObj).length;
            if(quedan === 0) {
                jugando = false;
                if(nivel < 5) {
                    nivel++;
                    alert("¬°NIVEL SUPERADO!");
                    iniciarNivel();
                } else {
                    endGame("¬°ERES UN CRACK DE LA FUSI√ìN!");
                }
            }
        }

        function endGame(msg) {
            jugando = false;
            const tiempo = document.getElementById('txt-timer').innerText;
            const nombre = document.getElementById('paciente').value;
            
            // Env√≠o al Google Form (Excel)
            const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfcw4zd4GvGH8TVc_C2oWJOAHQbZ2PM_uRlREwbjeOq6HdXIQ/formResponse";
            const formData = new FormData();
            formData.append("entry.1571018380", nombre);
            formData.append("entry.1811640882", "Integraci√≥n Binocular");
            formData.append("entry.1634944997", nivel);
            formData.append("entry.991256689", totalAciertos);
            formData.append("entry.1808531736", tiempo);
            formData.append("entry.651647598", new Date().toISOString().split('T')[0]);

            fetch(formURL, { method: "POST", mode: "no-cors", body: formData });

            alert(`${msg}\nResumen enviado a la cl√≠nica.`);
            location.reload();
        }
    </script>
</body>
</html>


