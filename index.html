<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integraci√≥n Binocular - Cl√≠nica Visual</title>
    <style>
        :root { 
            --bg: radial-gradient(circle, #1e293b 0%, #0f172a 100%); 
            --accent: #f472b6; /* Un rosa/fucsia vibrante para binocular */
            --card: rgba(30, 41, 59, 0.7); 
            --error: #f43f5e; 
            --success: #10b981; 
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; }
        
        #setup-screen, #instruction-screen, #msg-screen, #next-level-screen { 
            position: fixed; inset: 0; background: var(--bg); z-index: 2000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px; text-align: center; 
        }

        /* Ficha de Objetivos */
        .ficha-objetivos {
            background: rgba(244, 114, 182, 0.1);
            border: 2px solid rgba(244, 114, 182, 0.3);
            border-radius: 24px;
            padding: 25px;
            margin: 20px 0;
            max-width: 450px;
            text-align: left;
            backdrop-filter: blur(10px);
        }
        .obj-item { display: flex; align-items: center; margin-bottom: 18px; }
        .obj-icon {
            font-size: 1.8rem;
            margin-right: 20px;
            background: var(--card);
            min-width: 55px; height: 55px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .obj-texto b { color: var(--accent); font-size: 1.1rem; display: block; }
        .obj-texto span { font-size: 0.95rem; color: #cbd5e1; line-height: 1.4; }

        .btn-grande { background: var(--accent); color: white; padding: 18px 45px; border-radius: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; border: none; margin-top: 10px; transition: 0.3s; box-shadow: 0 5px 20px rgba(244, 114, 182, 0.4); }
        .btn-grande:hover { transform: translateY(-3px); filter: brightness(1.1); }
        
        /* √Årea de Juego */
        #game-container { display: flex; gap: 50px; margin-top: 50px; position: relative; }
        .target-box { width: 150px; height: 150px; background: var(--card); border: 3px dashed var(--accent); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 4rem; cursor: pointer; transition: 0.2s; }
        .target-box:hover { background: rgba(244, 114, 182, 0.1); }

        .header-clinico { width: 100%; background: rgba(15, 23, 42, 0.8); padding: 15px; border-bottom: 3px solid var(--accent); display: flex; justify-content: space-around; backdrop-filter: blur(5px); }
        .stat-val { color: var(--accent); font-size: 1.3rem; display: block; font-weight: bold; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color:var(--accent); font-size: 2.5rem; text-shadow: 0 0 20px rgba(244, 114, 182, 0.5);">INTEGRACI√ìN BINOCULAR</h1>
        <input type="text" id="nombrePaciente" style="padding:15px; border-radius:12px; border:2px solid var(--accent); background:var(--card); color:white; width:300px; font-size:1.1rem; outline:none;" placeholder="Nombre del Paciente">
        <button class="btn-grande" onclick="mostrarInstrucciones()">Continuar</button>
    </div>

    <div id="instruction-screen" style="display:none">
        <h2 style="font-size: 2.2rem;">üåü ¬°A trabajar en equipo! üåü</h2>
        <p style="color: #cbd5e1;">Tus ojos aprender√°n a trabajar juntos hoy:</p>
        
        <div class="ficha-objetivos">
            <div class="obj-item">
                <div class="obj-icon">üëì</div>
                <div class="obj-texto">
                    <b>Fusi√≥n Sensorial</b>
                    <span>Entrenar al cerebro para unir dos im√°genes en una sola muy clara.</span>
                </div>
            </div>
            <div class="obj-item">
                <div class="obj-icon">üèîÔ∏è</div>
                <div class="obj-texto">
                    <b>Estereopsis</b>
                    <span>Mejorar la capacidad de ver en 3D y calcular distancias.</span>
                </div>
            </div>
            <div class="obj-item">
                <div class="obj-icon">üöÄ</div>
                <div class="obj-texto">
                    <b>Flexibilidad Binocular</b>
                    <span>Fortalecer el enfoque y el trabajo coordinado de ambos ojos.</span>
                </div>
            </div>
        </div>

        <button class="btn-grande" onclick="comenzarJuego()">¬°Empezar Misi√≥n!</button>
    </div>

    <div id="next-level-screen" style="display:none">
        <h2 style="color:var(--success); font-size: 2.5rem;">¬°Fusi√≥n Perfecta!</h2>
        <p id="stats-nivel" style="font-size: 1.2rem;"></p>
        <button class="btn-grande" onclick="iniciarNivel()">Siguiente Reto ‚ûî</button>
    </div>

    <div id="msg-screen" style="display:none">
        <h1 style="color:var(--accent)">Sesi√≥n Finalizada</h1>
        <p id="msg-subtitulo" style="font-size: 1.2rem; line-height: 1.8; white-space: pre-wrap;"></p>
        <button class="btn-grande" onclick="location.reload()">Terminar</button>
    </div>

    <div class="header-clinico">
        <div>NIVEL <span id="val-nivel" class="stat-val">1</span></div>
        <div>ACIERTOS <span id="val-ok" class="stat-val">0</span></div>
        <div>FALLOS <span id="val-err" style="color:var(--error)" class="stat-val">0</span></div>
        <div>TIEMPO <span id="val-timer" class="stat-val">0.0s</span></div>
    </div>

    <div id="game-container">
        <div class="target-box" onclick="checkTarget(true)" id="box1">üëÅÔ∏è</div>
        <div class="target-box" onclick="checkTarget(false)" id="box2">üëÅÔ∏è</div>
    </div>

    <script>
        let paciente = "", nivel = 1, aciertos = 0, fallos = 0, correctBox = 0;
        let startTime, timerInterval, jugando = false;
        const figuras = ["üåü", "üçé", "üöÄ", "üíé", "ü¶Å", "üåà", "üéà", "üç≠"];

        function mostrarInstrucciones() {
            paciente = document.getElementById('nombrePaciente').value.trim();
            if(!paciente) return alert("Por favor, pon el nombre");
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('instruction-screen').style.display = 'flex';
        }

        function comenzarJuego() {
            document.getElementById('instruction-screen').style.display = 'none';
            iniciarNivel();
        }

        function iniciarNivel() {
            document.getElementById('next-level-screen').style.display = 'none';
            document.getElementById('val-nivel').innerText = nivel;
            jugando = true;
            resetTimer();
            startTimer();
            generarEstimulo();
        }

        function generarEstimulo() {
            const icon = figuras[Math.floor(Math.random() * figuras.length)];
            correctBox = Math.random() > 0.5 ? 1 : 2;
            
            document.getElementById('box1').innerText = icon;
            document.getElementById('box2').innerText = icon;
            
            // Efecto de disparidad para forzar integraci√≥n
            document.getElementById('box1').style.transform = correctBox === 1 ? 'translateX(5px)' : 'translateX(-5px)';
            document.getElementById('box2').style.transform = correctBox === 2 ? 'translateX(5px)' : 'translateX(-5px)';
        }

        function checkTarget(isBox1) {
            if(!jugando) return;
            const hit = (isBox1 && correctBox === 1) || (!isBox1 && correctBox === 2);
            
            if(hit) {
                aciertos++;
                document.getElementById('val-ok').innerText = aciertos;
                if(aciertos % 5 === 0) {
                    avanzarNivel();
                } else {
                    generarEstimulo();
                }
            } else {
                fallos++;
                document.getElementById('val-err').innerText = fallos;
                document.body.style.backgroundColor = "#451a1a";
                setTimeout(() => document.body.style.backgroundColor = "", 100);
                if(fallos >= 5) finalizarYEnviar();
            }
        }

        function avanzarNivel() {
            jugando = false;
            stopTimer();
            document.getElementById('stats-nivel').innerText = `Completaste el Nivel ${nivel} con √©xito.`;
            document.getElementById('next-level-screen').style.display = 'flex';
            nivel++;
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                let diff = (Date.now() - startTime) / 1000;
                document.getElementById('val-timer').innerText = diff.toFixed(1) + "s";
            }, 100);
        }
        function stopTimer() { clearInterval(timerInterval); }
        function resetTimer() { document.getElementById('val-timer').innerText = "0.0s"; }

        function finalizarYEnviar() {
            stopTimer();
            jugando = false;
            const tiempoFinal = document.getElementById('val-timer').innerText;
            const URL_FORM = "https://docs.google.com/forms/d/e/1FAIpQLSdxsgdNOW4NRJU_jpePwURa6aiX89o-X5b90ofN6zxs396eEg/formResponse";
            
            const fd = new FormData();
            fd.append("entry.76353775", paciente);
            fd.append("entry.1871220940", "Integraci√≥n binocular");
            fd.append("entry.839149548", nivel);
            fd.append("entry.356606780", aciertos);
            fd.append("entry.239436075", fallos);
            fd.append("entry.1745748054", tiempoFinal);
            fd.append("entry.534957775", new Date().toISOString().split('T')[0]);

            fetch(URL_FORM, { method: "POST", mode: "no-cors", body: fd });

            document.getElementById('msg-subtitulo').innerText = `Paciente: ${paciente}\nNivel Alcanzado: ${nivel}\nAciertos: ${aciertos}\nFallos: ${fallos}\nTiempo: ${tiempoFinal}`;
            document.getElementById('msg-screen').style.display = 'flex';
        }
    </script>
</body>
</html>

